.. code:: ipython3

    import pandas as pd
    import geopandas as gpd
    import pybdshadow
    #Read building data
    buildings = gpd.read_file(r'data/bd_demo.json')
    buildings

.. code:: ipython3

    #Preprocess building data before calculate shadow
    #It will remove empty polygons and convert multipolygons into polygons.
    buildings = pybdshadow.bd_preprocess(buildings)

Shadow generated by Sun light
=============================

.. code:: ipython3

    #Given UTC time
    date = pd.to_datetime('2015-01-01 02:45:33.959797119')
    #Calculate shadows
    shadows = pybdshadow.bdshadow_sunlight(buildings,date)
    shadows




.. raw:: html

    <div>
    <style scoped>
        .dataframe tbody tr th:only-of-type {
            vertical-align: middle;
        }
    
        .dataframe tbody tr th {
            vertical-align: top;
        }
    
        .dataframe thead th {
            text-align: right;
        }
    </style>
    <table border="1" class="dataframe">
      <thead>
        <tr style="text-align: right;">
          <th></th>
          <th>building_id</th>
          <th>geometry</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <th>0</th>
          <td>0</td>
          <td>POLYGON ((139.69831 35.53380, 139.69831 35.533...</td>
        </tr>
        <tr>
          <th>1</th>
          <td>1</td>
          <td>POLYGON ((139.69881 35.53389, 139.69881 35.533...</td>
        </tr>
        <tr>
          <th>2</th>
          <td>2</td>
          <td>POLYGON ((139.69837 35.53484, 139.69837 35.535...</td>
        </tr>
        <tr>
          <th>3</th>
          <td>3</td>
          <td>POLYGON ((139.69864 35.53477, 139.69864 35.534...</td>
        </tr>
        <tr>
          <th>4</th>
          <td>4</td>
          <td>POLYGON ((139.70015 35.53590, 139.70016 35.535...</td>
        </tr>
        <tr>
          <th>...</th>
          <td>...</td>
          <td>...</td>
        </tr>
        <tr>
          <th>1366</th>
          <td>1366</td>
          <td>POLYGON ((139.70882 35.55199, 139.70882 35.551...</td>
        </tr>
        <tr>
          <th>1367</th>
          <td>1367</td>
          <td>POLYGON ((139.70621 35.55182, 139.70621 35.552...</td>
        </tr>
        <tr>
          <th>1368</th>
          <td>1368</td>
          <td>POLYGON ((139.70570 35.55159, 139.70570 35.551...</td>
        </tr>
        <tr>
          <th>1369</th>
          <td>1369</td>
          <td>POLYGON ((139.70867 35.55133, 139.70867 35.551...</td>
        </tr>
        <tr>
          <th>1370</th>
          <td>1370</td>
          <td>POLYGON ((139.70823 35.55070, 139.70823 35.550...</td>
        </tr>
      </tbody>
    </table>
    <p>1371 rows × 2 columns</p>
    </div>



.. code:: ipython3

    #Visualize using matplotlib
    import matplotlib.pyplot as plt
    fig = plt.figure(1,(12,12))
    ax = plt.subplot(111)
    
    shadows.plot(ax = ax,facecolor = (0,0,0,0.3))
    buildings.plot(ax = ax,edgecolor = 'k')
    
    plt.show()



.. image:: output_4_0.png


.. code:: ipython3

    #Visualize using keplergl
    pybdshadow.show_bdshadow(buildings = buildings,shadows = shadows)


.. parsed-literal::

    User Guide: https://docs.kepler.gl/docs/keplergl-jupyter



.. parsed-literal::

    KeplerGl(config={'version': 'v1', 'config': {'visState': {'filters': [], 'layers': [{'id': 'lz48o3', 'type': '…


Shadow generated by Point light
===============================

.. code:: ipython3

    #Calculate building shadow for point light
    shadows = pybdshadow.bdshadow_pointlight(buildings,139.713319,35.552040,200)
    #Visualize buildings and shadows
    pybdshadow.show_bdshadow(buildings = buildings,shadows = shadows)


.. parsed-literal::

    User Guide: https://docs.kepler.gl/docs/keplergl-jupyter



.. parsed-literal::

    KeplerGl(config={'version': 'v1', 'config': {'visState': {'filters': [], 'layers': [{'id': 'lz48o3', 'type': '…


Billboard visual area analyze
=============================

.. code:: ipython3

    #ad_params for the billboard should be defined. It has two forms
    #1. Given the coordinates of brandCenter, orientation and height
    ad_params = {'orientation': 1.2806657381630058,
                'height': 10,
                'brandCenter': [139.71259, 35.552842999999996]} 
    
    #2. Given the coordinates of the two border points and height
    ad_params = {'point1': [139.711861, 35.552040],
                'point2': [139.713319, 35.553646],#1861,3646
                'height': 50,
                }
    
    #calculate the visual area
    visualArea,shadows = pybdshadow.ad_visualArea(ad_params,buildings)
    
    #Generate a GeoDataFrame from ad_params for visualization
    billboard_gdf = pybdshadow.ad_to_gdf(ad_params,billboard_height = 100)
    
    #Visualize buildings, shadows, billboard and visual area
    pybdshadow.show_bdshadow(buildings=buildings,
                             shadows=shadows,
                             ad=billboard_gdf,
                             ad_visualArea=visualArea)


.. parsed-literal::

    User Guide: https://docs.kepler.gl/docs/keplergl-jupyter



.. parsed-literal::

    KeplerGl(config={'version': 'v1', 'config': {'visState': {'filters': [], 'layers': [{'id': 'lz48o1', 'type': '…


